<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
        
        <!-- Font Awesome pour les icônes -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        
        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}
        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
            <script>
                window.userInfo = {
                    isLoggedIn: {{ app.user ? 'true' : 'false' }},
                    username: '{{ app.user ? app.user.username : '' }}',
                    usernameColor: '{{ app.user ? (app.user.usernameColor ?? '#8b3a3a') : '#8b3a3a' }}',
                    preferredIcon: '{{ app.user ? (app.user.preferredIcon ?? 'user') : 'user' }}'
                };
            </script>
        {% endblock %}
    </head>
    <body>
        <header>
            <nav class="navbar-modern">
                {# Menu burger pour mobile #}
                <button class="navbar-burger" type="button" aria-label="Menu mobile">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                {# Dropdown menu - SÉPARÉ du logo #}
                <div class="navbar-dropdown">
                    <ul class="navbar-nav-links">
                        {# Groupe de gauche #}
                        <div class="nav-left">
                            <li><a href="{{ path('app_homepage') }}" class="dropdown-item"><i class="fas fa-home"></i> Accueil</a></li>
                            {% if app.user %}
                                <li><a href="{{ path('app_homepage') }}#battle" class="dropdown-item"><i class="fas fa-sword"></i> Combat</a></li>
                                <li><a href="{{ path('app_homepage') }}#team" class="dropdown-item"><i class="fas fa-users"></i> Mon Équipe</a></li>
                            {% else %}
                                <li><a href="#" class="dropdown-item"><i class="fas fa-question-circle"></i> Comment Jouer</a></li>
                                <li><a href="{{ path('app_homepage') }}#characters" class="dropdown-item"><i class="fas fa-user-friends"></i> Personnages</a></li>
                            {% endif %}
                        </div>
                        
                        {# Espace central réservé pour le logo - VIDE #}
                        
                        {# Groupe de droite #}
                        <div class="nav-right">
                        {% if app.user and is_granted("ROLE_ADMIN") %}
                                <li><a href="{{ path('admin') }}" class="dropdown-item"><i class="fas fa-cog"></i> Administration</a></li>
                        {% endif %}
                            {% if app.user %}
                                <li><a href="{{ path('app_homepage') }}#ranking" class="dropdown-item"><i class="fas fa-trophy"></i> Classements</a></li>
                                <li><a href="{{ path('app_profile') }}" class="dropdown-item"><i class="fas fa-user-circle"></i> Profil</a></li>
                                <li><a href="{{ path('app_logout') }}" class="dropdown-item logout-link"><i class="fas fa-sign-out-alt"></i> Déconnexion</a></li>
                            {% else %}
                                <li><a href="{{ path('app_homepage') }}#ranking" class="dropdown-item"><i class="fas fa-trophy"></i> Classements</a></li>
                                <li><a href="{{ path('app_register') }}" class="dropdown-item"><i class="fas fa-user-plus"></i> S'inscrire</a></li>
                                <li><a href="{{ path('app_login') }}" class="dropdown-item"><i class="fas fa-sign-in-alt"></i> Connexion</a></li>
                            {% endif %}
                        </div>
                    </ul>
                </div>
            </nav>
            
            {# Logo SÉPARÉ et INDÉPENDANT - au-dessus de tout #}
            <div class="navbar-logo-container">
                <button class="navbar-logo" type="button" aria-label="Menu principal">
                    <img src="{{ asset('images/logo1.png') }}" alt="SST Logo">
                </button>
            </div>
        {# Menu mobile plein écran #}
        <div class="navbar-mobile-menu">
                <div class="mobile-menu-content">
                    {% if app.user %}
                        <a href="{{ path('app_homepage') }}" class="mobile-nav-link"><i class="fas fa-home"></i> Accueil</a>
                        <a href="{{ path('app_homepage') }}#battle" class="mobile-nav-link"><i class="fas fa-sword"></i> Combat</a>
                        <a href="{{ path('app_homepage') }}#team" class="mobile-nav-link"><i class="fas fa-users"></i> Mon Équipe</a>
                        <a href="{{ path('app_homepage') }}#characters" class="mobile-nav-link"><i class="fas fa-user-friends"></i> Personnages</a>
                        {% if path('app_matchmaking') is defined %}
                            <a href="{{ path('app_matchmaking') }}" class="mobile-nav-link"><i class="fas fa-search"></i> Matchmaking</a>
                        {% endif %}
                        <a href="{{ path('app_homepage') }}#history" class="mobile-nav-link"><i class="fas fa-history"></i> Historique</a>
                        <a href="{{ path('app_homepage') }}#ranking" class="mobile-nav-link"><i class="fas fa-trophy"></i> Classements</a>
                        <a href="{{ path('app_profile') }}" class="mobile-nav-link"><i class="fas fa-user-circle"></i> Profil</a>
                        
                        <a href="{{ path('app_logout') }}" class="mobile-nav-link logout-link"><i class="fas fa-sign-out-alt"></i> Se Déconnecter</a>
                    {% else %}
                        <a href="{{ path('app_homepage') }}" class="mobile-nav-link"><i class="fas fa-home"></i> Accueil</a>
                        <a href="#" class="mobile-nav-link"><i class="fas fa-question-circle"></i> Comment Jouer</a>
                        <a href="{{ path('app_homepage') }}#characters" class="mobile-nav-link"><i class="fas fa-user-friends"></i> Personnages</a>
                        <a href="{{ path('app_homepage') }}#ranking" class="mobile-nav-link"><i class="fas fa-trophy"></i> Classements</a>
                        <a href="{{ path('app_register') }}" class="mobile-nav-link"><i class="fas fa-user-plus"></i> Créer un Compte</a>
                        <a href="{{ path('app_login') }}" class="mobile-nav-link"><i class="fas fa-sign-in-alt"></i> Se Connecter</a>
                    {% endif %}
                </div>
            </div>
        </header>

        <main>
            {% block body %}
                <!-- Titre principal -->
                <div class="main-title">
                    <h1>Santons Script Tactics</h1>
                    <p class="subtitle">Créez votre équipe de 3 héros et affrontez d'autres joueurs !</p>
                </div>

                <!-- Interface de jeu principale -->
                <div class="game-interface">
                    <div class="game-card">
                        <!-- Onglets de navigation -->
                        <div class="game-tabs">
                            <button class="tab-button active" data-tab="team">
                                <i class="fas fa-users"></i> Mon Équipe
                            </button>
                            <button class="tab-button" data-tab="characters">
                                <i class="fas fa-user-friends"></i> Personnages
                            </button>
                            <button class="tab-button" data-tab="battle">
                                <i class="fas fa-sword"></i> Combat
                            </button>
                            <button class="tab-button" data-tab="ranking">
                                <i class="fas fa-trophy"></i> Classement
                            </button>
                            <button class="tab-button" data-tab="history">
                                <i class="fas fa-history"></i> Historique
                            </button>
                        </div>

                        <!-- Contenu des onglets -->
                        <div class="tab-content">
                            <!-- Onglet Mon Équipe -->
                            <div class="tab-panel active" id="team-panel">
                                <h2>Formation de votre Équipe</h2>
                                <div class="team-slots">
                                    <div class="character-slot" data-slot="1">
                                        <div class="slot-placeholder">
                                            <i class="fas fa-plus"></i>
                                            <span>Héros 1</span>
                                        </div>
                                    </div>
                                    <div class="character-slot" data-slot="2">
                                        <div class="slot-placeholder">
                                            <i class="fas fa-plus"></i>
                                            <span>Héros 2</span>
                                        </div>
                                    </div>
                                    <div class="character-slot" data-slot="3">
                                        <div class="slot-placeholder">
                                            <i class="fas fa-plus"></i>
                                            <span>Héros 3</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Onglet Personnages -->
                            <div class="tab-panel" id="characters-panel">
                                <h2>Personnages Disponibles</h2>
                                <div class="characters-grid">
                                    <p class="loading-text">Chargement des personnages...</p>
                                </div>
                            </div>

                            <!-- Onglet Combat -->
                            <div class="tab-panel" id="battle-panel">
                                <h2>Rechercher un Combat</h2>
                                
                                <!-- Section de sélection d'équipe -->
                                <div id="team-selection" class="battle-search">
                                    {% if app.user %}
                                        <div class="team-info">
                                            <p class="info-text">Équipe prête pour le combat</p>
                                            <div class="team-power">Puissance: <span id="team-power-display">Calcul...</span></div>
                                        </div>
                                        <button class="search-battle-btn" id="search-battle-btn" data-team-id="1">
                                            <i class="fas fa-search"></i> Rechercher un Match
                                        </button>
                                    {% else %}
                                        <p class="info-text">Connectez-vous pour commencer à jouer</p>
                                        <a href="{{ path('app_login') }}" class="search-battle-btn">
                                            <i class="fas fa-sign-in-alt"></i> Se connecter
                                        </a>
                                    {% endif %}
                                </div>

                                <!-- Section de statut de matchmaking -->
                                <div id="matchmaking-status" class="matchmaking-status" style="display: none;">
                                    <div class="status-indicator">
                                        <div class="spinner"></div>
                                        <div class="status-text">
                                            <h3 id="status-text">Recherche en cours...</h3>
                                            <p id="waiting-time">Temps d'attente: 0 secondes</p>
                                            <p id="players-in-queue">Joueurs en file: 0</p>
                                        </div>
                                    </div>
                                    <button id="cancel-queue" class="btn btn-danger">
                                        <i class="fas fa-times"></i> Annuler la recherche
                                    </button>
                                </div>

                                <!-- Section résultat de match -->
                                <div id="match-result" class="match-result" style="display: none;">
                                    <h3 id="result-title">Combat terminé !</h3>
                                    <div id="result-content"></div>
                                    <button id="back-to-search" class="search-battle-btn">
                                        <i class="fas fa-redo"></i> Nouveau Combat
                                    </button>
                                </div>
                            </div>

                                                        <!-- Onglet Classement -->
                            <div class="tab-panel" id="ranking-panel">
                                <h2>Classement des Joueurs</h2>
                                
                                <!-- Indicateur position utilisateur (sticky) -->
                                {% if app.user %}
                                <div class="user-ranking-sticky" id="userRankingSticky">
                                    <div class="user-position-indicator">
                                        <span class="position-text">Votre position:</span>
                                        <span class="position-number">#-</span>
                                        <span class="rating-text">- pts</span>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Classement général -->
                                <div class="general-ranking">
                                    <div class="ranking-controls">
                                        <button class="ranking-btn active" data-filter="global">
                                            <i class="fas fa-globe"></i> Global
                                        </button>
                                        <button class="ranking-btn" data-filter="weekly">
                                            <i class="fas fa-calendar-week"></i> Semaine
                                        </button>
                                        <button class="ranking-btn" data-filter="monthly">
                                            <i class="fas fa-calendar-alt"></i> Mois
                                        </button>
                                    </div>

                                    <div class="ranking-list" id="ranking-list">
                                        <p class="loading-text">Chargement du classement...</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Onglet Historique -->
                            <div class="tab-panel" id="history-panel">
                                <h2>Historique des Combats</h2>
                                <div class="match-history">
                                    <p class="empty-history">Aucun combat joué pour le moment</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endblock %}
        </main>
    </body>
</html>